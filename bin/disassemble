#!/usr/bin/env ruby

# ./disassemble vice-city games/vice-city/data/main.scm

puts ARGV.inspect

if ENV["PWD"].split(/\//)[-1] == "gta-scm"
# require_relative '../lib/gta_scm'
  $: << "./lib"
  require 'gta_scm'
end

mem_use_bytes = (`ps -o rss= -p #{$$}`.to_i * 1024)
puts "Memory usage: #{mem_use_bytes/1024/1024} MB"

scm = GtaScm::Scm.load(ARGV[1])

scm.load_opcode_definitions!
scm.parse!

mem_use_bytes = (`ps -o rss= -p #{$$}`.to_i * 1024)
puts "Memory usage: #{mem_use_bytes/1024/1024} MB"
